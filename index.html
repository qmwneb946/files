<html lang="zh-cn">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>文件上传 - Stupid Online Judge</title>
	<script type="text/javascript">uojHome = '/'</script>
	<!-- Bootstrap core CSS -->
	<link type="text/css" rel="stylesheet" href="/css/bootstrap.min.css">
	<!-- Bootstrap theme -->
	<link type="text/css" rel="stylesheet" href="/css/bootstrap-theme.min.css">
	<!-- Custom styles for this template -->
	<link type="text/css" rel="stylesheet" href="/css/soj-theme.css">
	<!-- jQuery (necessary for Bootstrap\'s JavaScript plugins) -->
	<script src="/js/jquery.min.js"></script>
	<!-- jQuery autosize -->
	<script src="/js/jquery.autosize.min.js"></script>
	<script type="text/javascript">
		$(document).ready(function () {
			$('textarea').autosize();
		});
	</script>
	<!-- jQuery cookie -->
	<script src="/js/jquery.cookie.min.js"></script>
	<!-- jQuery modal -->
	<script src="/js/jquery.modal.js"></script>
	<!-- Include all compiled plugins (below), or include individual files as needed -->
	<script src="/js/bootstrap.min.js"></script>
	<!-- Color converter -->
	<script src="/js/color-converter.min.js"></script>
	<!-- soj -->
	<script src="/js/soj.js"></script>
	<!-- readmore -->
	<script src="/js/readmore/readmore.min.js"></script>
	<!-- LAB -->
	<script src="/js/LAB.min.js"></script>
	<!-- UOJ ico -->
	<link rel="shortcut icon" href="/pictures/SOJ.ico">
	<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
		<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->
	<script type="text/javascript">
		before_window_unload_message = null;
		$(window).on('beforeunload', function () {
			if (before_window_unload_message !== null) {
				return before_window_unload_message;
			}
		});
	</script>
</head>
<body role="document">
	<div class="container theme-showcase" role="main">
		<div class="uoj-content">
			<script>
				$(document).ready(function () {
					$('#form-upload').submit(function (e) {
						var ok = true;
						$(this).find("input[type='file']").each(function () {
							for (var i = 0; i < this.files.length; i++) {
								if (this.files[i].size > 52428800) {
									$('#div-' + $(this).attr('name')).addClass('has-error');
									$('#help-' + $(this).attr('name')).text('文件大小不能超过 50M');
									ok = false;
								} else {
									$('#div-' + $(this).attr('name')).removeClass('has-error');
									$('#help-' + $(this).attr('name')).text('');
								}
							}
						});
						return ok;
					});
				});
			</script>
			<h3>文件列表</h3>
			<div id="file-list">
				<div class="table-responsive">
					<table class="table table-bordered table-hover table-striped table-text-center">
						<thead>
							<tr>
								<th>ID</th>
								<th>文件名</th>
								<th>完整路径</th>
								<th>文件大小</th>
								<th>操作</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>1</td>
								<td>index.html</td>
								<td><a href="/uploads/qmwneb/index.html" target="_blank">/uploads/qmwneb/index.html</a>
								</td>
								<td>12.1KiB</td>
								<td><a href="#"><span class="glyphicon glyphicon-remove"></span> Delete</a></td>
							</tr>
							<tr>
								<td>2</td>
								<td>pan.html</td>
								<td><a href="/uploads/qmwneb/pan.html" target="_blank">/uploads/qmwneb/pan.html</a></td>
								<td>16.6KiB</td>
								<td><a href="#"><span class="glyphicon glyphicon-remove"></span> Delete</a></td>
							</tr>
							<tr>
								<td>3</td>
								<td>代数Part1.pdf</td>
								<td><a href="/uploads/qmwneb/代数Part1.pdf"
										target="_blank">/uploads/qmwneb/代数Part1.pdf</a></td>
								<td>25.52MiB</td>
								<td><a href="#"><span class="glyphicon glyphicon-remove"></span> Delete</a></td>
							</tr>
							<tr>
								<td>4</td>
								<td>代数Part2.pdf</td>
								<td><a href="/uploads/qmwneb/代数Part2.pdf"
										target="_blank">/uploads/qmwneb/代数Part2.pdf</a></td>
								<td>24.22MiB</td>
								<td><a href="#"><span class="glyphicon glyphicon-remove"></span> Delete</a></td>
							</tr>
							<tr>
								<td>5</td>
								<td>代数Part3.pdf</td>
								<td><a href="/uploads/qmwneb/代数Part3.pdf"
										target="_blank">/uploads/qmwneb/代数Part3.pdf</a></td>
								<td>24.29MiB</td>
								<td><a href="#"><span class="glyphicon glyphicon-remove"></span> Delete</a></td>
							</tr>
							<tr>
								<td>6</td>
								<td>代数Part4.pdf</td>
								<td><a href="/uploads/qmwneb/代数Part4.pdf"
										target="_blank">/uploads/qmwneb/代数Part4.pdf</a></td>
								<td>25.18MiB</td>
								<td><a href="#"><span class="glyphicon glyphicon-remove"></span> Delete</a></td>
							</tr>
							<tr>
								<td>7</td>
								<td>代数Part5.pdf</td>
								<td><a href="/uploads/qmwneb/代数Part5.pdf"
										target="_blank">/uploads/qmwneb/代数Part5.pdf</a></td>
								<td>16.20MiB</td>
								<td><a href="#"><span class="glyphicon glyphicon-remove"></span> Delete</a></td>
							</tr>
							<tr>
								<td>8</td>
								<td>其它.zip</td>
								<td><a href="/uploads/qmwneb/其它.zip" target="_blank">/uploads/qmwneb/其它.zip</a></td>
								<td>7.65MiB</td>
								<td><a href="#"><span class="glyphicon glyphicon-remove"></span> Delete</a></td>
							</tr>
							<tr>
								<td>9</td>
								<td>动态规划.zip</td>
								<td><a href="/uploads/qmwneb/动态规划.zip" target="_blank">/uploads/qmwneb/动态规划.zip</a></td>
								<td>16.54MiB</td>
								<td><a href="#"><span class="glyphicon glyphicon-remove"></span> Delete</a></td>
							</tr>
							<tr>
								<td>10</td>
								<td>图论.zip</td>
								<td><a href="/uploads/qmwneb/图论.zip" target="_blank">/uploads/qmwneb/图论.zip</a></td>
								<td>42.70MiB</td>
								<td><a href="#"><span class="glyphicon glyphicon-remove"></span> Delete</a></td>
							</tr>
							<tr>
								<td>11</td>
								<td>基础算法.zip</td>
								<td><a href="/uploads/qmwneb/基础算法.zip" target="_blank">/uploads/qmwneb/基础算法.zip</a></td>
								<td>12.53MiB</td>
								<td><a href="#"><span class="glyphicon glyphicon-remove"></span> Delete</a></td>
							</tr>
							<tr>
								<td>12</td>
								<td>字符串.zip</td>
								<td><a href="/uploads/qmwneb/字符串.zip" target="_blank">/uploads/qmwneb/字符串.zip</a></td>
								<td>10.47MiB</td>
								<td><a href="#"><span class="glyphicon glyphicon-remove"></span> Delete</a></td>
							</tr>
							<tr>
								<td>13</td>
								<td>数学1.zip</td>
								<td><a href="/uploads/qmwneb/数学1.zip" target="_blank">/uploads/qmwneb/数学1.zip</a></td>
								<td>45.96MiB</td>
								<td><a href="#"><span class="glyphicon glyphicon-remove"></span> Delete</a></td>
							</tr>
							<tr>
								<td>14</td>
								<td>数学2.zip</td>
								<td><a href="/uploads/qmwneb/数学2.zip" target="_blank">/uploads/qmwneb/数学2.zip</a></td>
								<td>33.07MiB</td>
								<td><a href="#"><span class="glyphicon glyphicon-remove"></span> Delete</a></td>
							</tr>
							<tr>
								<td>15</td>
								<td>数据结构.zip</td>
								<td><a href="/uploads/qmwneb/数据结构.zip" target="_blank">/uploads/qmwneb/数据结构.zip</a></td>
								<td>44.74MiB</td>
								<td><a href="#"><span class="glyphicon glyphicon-remove"></span> Delete</a></td>
							</tr>
							<tr>
								<td>16</td>
								<td>洛谷Part1.pdf</td>
								<td><a href="/uploads/qmwneb/洛谷Part1.pdf"
										target="_blank">/uploads/qmwneb/洛谷Part1.pdf</a></td>
								<td>17.25MiB</td>
								<td><a href="#"><span class="glyphicon glyphicon-remove"></span> Delete</a></td>
							</tr>
							<tr>
								<td>17</td>
								<td>洛谷Part2.pdf</td>
								<td><a href="/uploads/qmwneb/洛谷Part2.pdf"
										target="_blank">/uploads/qmwneb/洛谷Part2.pdf</a></td>
								<td>18.14MiB</td>
								<td><a href="#"><span class="glyphicon glyphicon-remove"></span> Delete</a></td>
							</tr>
							<tr>
								<td>18</td>
								<td>洛谷Part3.pdf</td>
								<td><a href="/uploads/qmwneb/洛谷Part3.pdf"
										target="_blank">/uploads/qmwneb/洛谷Part3.pdf</a></td>
								<td>19.06MiB</td>
								<td><a href="#"><span class="glyphicon glyphicon-remove"></span> Delete</a></td>
							</tr>
							<tr>
								<td>19</td>
								<td>洛谷Part4.pdf</td>
								<td><a href="/uploads/qmwneb/洛谷Part4.pdf"
										target="_blank">/uploads/qmwneb/洛谷Part4.pdf</a></td>
								<td>19.19MiB</td>
								<td><a href="#"><span class="glyphicon glyphicon-remove"></span> Delete</a></td>
							</tr>
							<tr>
								<td>20</td>
								<td>洛谷Part5.pdf</td>
								<td><a href="/uploads/qmwneb/洛谷Part5.pdf"
										target="_blank">/uploads/qmwneb/洛谷Part5.pdf</a></td>
								<td>4.48MiB</td>
								<td><a href="#"><span class="glyphicon glyphicon-remove"></span> Delete</a></td>
							</tr>
							<tr>
								<td>21</td>
								<td>计算几何.zip</td>
								<td><a href="/uploads/qmwneb/计算几何.zip" target="_blank">/uploads/qmwneb/计算几何.zip</a></td>
								<td>19.07MiB</td>
								<td><a href="#"><span class="glyphicon glyphicon-remove"></span> Delete</a></td>
							</tr>
							<tr>
								<td>22</td>
								<td>题解.zip</td>
								<td><a href="/uploads/qmwneb/题解.zip" target="_blank">/uploads/qmwneb/题解.zip</a></td>
								<td>3.45MiB</td>
								<td><a href="#"><span class="glyphicon glyphicon-remove"></span> Delete</a></td>
							</tr>
						</tbody>
					</table>
				</div>
				<div class="text-right text-muted">共 22 个文件</div>
			</div>
			<script>
				function soj_file_delete(name, interactive) {
					$.post('/file-upload', {
						delete: name
					}, function (msg) {
						if (interactive) {
							if (msg === 'ok')
								location.reload();
							else
								alert('删除失败！');
						} else {
							if (msg === 'ok')
								console.log('文件 ' + name + ' 删除成功！(请手动刷新页面)');
							else
								console.log('文件 ' + name + ' 删除失败！(错误信息：' + msg + ')');
						}
					});
				}
				$(document).ready(function () {
					$('.click-to-show').click(function (e) {
						var entries = [], list = [
							'uploads/qmwneb'
						];
						e.preventDefault();
						for (var dir of list)
							$.ajax('/file-upload', {
								type: 'POST',
								dataType: 'json',
								async: false,
								data: {
									ls: dir
								},
								success: function (data) {
									for (var f of data) {
										entries.push([f[0], dir + '/' + f[0], '/' + dir + '/' + f[0], f[1]]);
									}
								}
							});
						$('#file-list').long_table(
							entries,
							1,
							'<tr>' +
							'<th>ID</th>' +
							'<th>' + uojLocale('file name') + '</th>' +
							'<th>' + uojLocale('file complete path') + '</th>' +
							'<th>' + uojLocale('file size') + '</th>' +
							'<th>' + uojLocale('operation') + '</th>' +
							'</tr>',
							function (row, idx) {
								return $('<tr />').append(
									$('<td>' + (idx + 1) + '</td>')
								).append(
									$('<td>' + row[0] + '</td>')
								).append(
									$('<td />').append(
										$('<a href="' + row[2] + '" target="_blank">' + row[2] + '</a></td>')
									)
								).append(
									$('<td>' + getFileSizeStr(row[3]) + '</td>')
								).append(
									$('<td />').append(
										$('<a href="#"><span class="glyphicon glyphicon-remove"></span> Delete</a>').click(function (e) {
											e.preventDefault();
											if (!confirm("您真的要删除文件 '" + row[1] + "' 吗？")) return;
											soj_file_delete(row[1], true);
										})
									)
								);
							}, {
							get_row_index: true,
							page_len: 100,
							print_after_table: function () {
								return '<div class="text-right text-muted">' + uojLocale("files::n files", entries.length) + '</div>';
							}
						}
						);
					});
					console.log("请使用 soj_file_delete('path/to/file') 来批量删除文件。");
				});
			</script>
		</div>
	</div>
</body>
</html>
